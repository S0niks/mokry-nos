<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Животные - Мокрый нос</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
  <div id="navbar"></div>
  <h1>Животные</h1>
  <div id="filters">
    <input type="text" id="name-filter" placeholder="Поиск по имени" onkeyup="loadAnimals()">
    <select id="species-filter" multiple onchange="loadAnimals()">
      <option value="">Все виды</option>
      <option value="cat">Кошка</option>
      <option value="dog">Собака</option>
    </select>
    <select id="gender-filter" multiple onchange="loadAnimals()">
      <option value="">Все полы</option>
      <option value="male">Мужской</option>
      <option value="female">Женский</option>
    </select>
    <select id="status-filter" multiple onchange="loadAnimals()">
      <option value="">Все статусы</option>
      <option value="в поиске семьи">В поиске семьи</option>
      <option value="нашел семью">Нашел семью</option>
      <option value="на лечение">На лечение</option>
    </select>
    <button onclick="clearFilters()">Сбросить фильтры</button>
  </div>
  <div id="animals-list"></div>
  <script>
    fetch('/components/navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navbar').innerHTML = data;
        const token = localStorage.getItem('token');
        const authButtons = document.getElementById('auth-buttons');
        if (token) {
          authButtons.innerHTML = `<a href="/pages/profile.html">Профиль</a>`;
        } else {
          authButtons.innerHTML = `<a href="/pages/login.html">Вход</a>`;
        }
      })
      .catch(err => console.error('Ошибка загрузки навигации:', err));

    function loadAnimals() {
      const token = localStorage.getItem('token');
      const name = document.getElementById('name-filter').value;
      const species = Array.from(document.getElementById('species-filter').selectedOptions).map(opt => opt.value).filter(v => v);
      const gender = Array.from(document.getElementById('gender-filter').selectedOptions).map(opt => opt.value).filter(v => v);
      const status = Array.from(document.getElementById('status-filter').selectedOptions).map(opt => opt.value).filter(v => v);

      const params = new URLSearchParams();
      if (name) params.append('name', name);
      if (species.length) params.append('species', species.join(','));
      if (gender.length) params.append('gender', gender.join(','));
      if (status.length) params.append('status', status.join(','));

      fetch(`/api/animals?${params.toString()}`, {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      })
        .then(response => response.json())
        .then(animals => {
          const animalsList = document.getElementById('animals-list');
          animalsList.innerHTML = animals.map(animal => `
            <div class="animal-item">
              <h3>${animal.name}</h3>
              <p>Вид: ${animal.species === 'cat' ? 'Кошка' : 'Собака'}</p>
              <p>Пол: ${animal.gender === 'male' ? 'Мужской' : 'Женский'}</p>
              <p>Статус: ${animal.status}</p>
              <p>Описание: ${animal.description || 'Нет описания'}</p>
              ${animal.image ? `<img src="${animal.image}" alt="${animal.name}" style="max-width: 200px;">` : ''}
            </div>
          `).join('');
        })
        .catch(err => console.error('Ошибка загрузки животных:', err));
    }

    function clearFilters() {
      document.getElementById('name-filter').value = '';
      document.getElementById('species-filter').selectedIndex = 0;
      document.getElementById('gender-filter').selectedIndex = 0;
      document.getElementById('status-filter').selectedIndex = 0;
      loadAnimals();
    }

    // Загрузка животных при открытии страницы
    window.onload = loadAnimals;
  </script>
</body>
</html>