<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Животные - Мокрый нос</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
  <div id="navbar"></div>
  <h1>Наши животные</h1>
  <div id="admin-controls" style="display: none;">
    <button id="add-animal-button">Добавить животное</button>
  </div>
  <div id="animals-list"></div>
  <script>
    fetch('/components/navbar.html')
      .then(response => response.text())
      .then(data => document.getElementById('navbar').innerHTML = data)
      .catch(err => console.error('Ошибка загрузки навигации:', err));fetch('/components/navbar.html')
      .then(response => response.text())
      .then(data => { 
        document.getElementById('navbar').innerHTML = data;
      // Добавляем логику отображения кнопок
        const token = localStorage.getItem('token');
        const authButtons = document.getElementById('auth-buttons');
        if (token) {
          console.log('Пользователь авторизован, показываем Профиль');
          authButtons.innerHTML = `<a href="/pages/profile.html">Профиль</a>`;
        } else {
          console.log('Пользователь не авторизован, показываем Вход');
          authButtons.innerHTML = `<a href="/pages/login.html">Вход</a>`;
        }
      })

    // Проверка роли пользователя
    const token = localStorage.getItem('token');
    if (token) {
      fetch('/api/users/profile', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      })
        .then(response => {
          if (!response.ok) throw new Error('Не удалось загрузить профиль');
          return response.json();
        })
        .then(data => {
          if (data.role === 'admin') {
            document.getElementById('admin-controls').style.display = 'block';
          }
        })
        .catch(err => {
          console.error('Ошибка загрузки профиля:', err);
        });
    }

    // Загрузка списка животных
    fetch('/api/animals')
      .then(response => response.json())
      .then(animals => {
        const animalsList = document.getElementById('animals-list');
        if (animals.length === 0) {
          animalsList.innerHTML = '<p>Животных пока нет.</p>';
        } else {
          animalsList.innerHTML = animals.map(animal => `
            <div class="animal-card">
              <h3>${animal.name}</h3>
              <p>Вид: ${animal.species}</p>
              <p>Пол: ${animal.gender}</p>
              <p>Описание: ${animal.description || 'Нет описания'}</p>
              <p>Статус: ${animal.status}</p>
              ${animal.image ? `<img src="${animal.image}" alt="${animal.name}" style="max-width: 200px;">` : ''}
            </div>
          `).join('');
        }
      })
      .catch(err => {
        console.error('Ошибка загрузки животных:', err);
        document.getElementById('animals-list').innerHTML = '<p>Ошибка загрузки животных.</p>';
      });

    // Обработчик кнопки "Добавить животное"
    document.getElementById('add-animal-button')?.addEventListener('click', () => {
      window.location.href = '/pages/add-animal.html';
    });
  </script>
</body>
</html>